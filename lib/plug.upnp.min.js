!function(a,b){function c(a){for(var b="",c=!0,d=32;d>0;){d-=4;var e=a>>d&15;c&&0==e||(c=!1,b+=t[e])}return""==b?"0":b}function d(a,b,c){for(var d=a,e=a.length;b>e;e++)d=c+d;return d}function e(a){return a=a.toString(16),1==a.length&&(a="0"+a),a="%"+a,unescape(a)}function f(a){a=a.toUpperCase().replace(new RegExp("s/[^0-9A-Z]//g"));for(var b="",c="",d=0;d<a.length;d++)c+=a.charAt(d),2==c.length&&(b+=e(parseInt(c,16)),c="");return b}function g(a){for(var b="",e=0;e<a.length;e++)b+=d(c(255&a.charCodeAt(e)),2,"0");return b}function h(a){return a.replace(/^([+-])?(\d+).?(\d*)[eE]([-+]?\d+)$/,function(a,b,c,d,e){var f=0>+e,g=c.length+ +e,a=(f?c:d).length,e=(e=Math.abs(e))>=a?e-a+f:0,h=new Array(e+1).join("0"),i=c+d;return(b||"")+(f?i=h+i:i+=h).substr(0,g+=f?h.length:0)+(g<i.length?"."+i.substr(g):"")})}var i=function(a,b){if(this.options=b||{debug:!1},this.svc=a,this.action=function(){},!(this.svc&&this.svc instanceof NetworkService))return this.debugLog("First argument provided in constructor MUST be a valid NetworkService object"),this;if(!this.svc.type||0!==this.svc.type.indexOf("upnp:"))return this.debugLog("First argument provided in constructor MUST be a _UPnP_ NetworkService object"),this;this.svcType=this.svc.type.replace("upnp:",""),this.svcUrl=this.svc.url;var c=this;this.action=function(a,b,d){var e=new Promise(function(e,f){d||"[object Function]"!=Object.prototype.toString.call(b)||(d=b,b={}),d&&"[object Function]"===Object.prototype.toString.call(d)||(d=function(){});var g=c.createRequest(c.svcType,a,b);c.sendRequest(c.svcType,a,c.svcUrl,g,function(g,h){return null!==g?(d.apply(c,[g,null]),void f(g)):void c.handleResponse(a,h.responseXML||"",b,function(a,b){d.apply(c,[a,b]),null!==a?f(a):e(b)})})});return e}};i.prototype.constructor=i,i.prototype.requestTemplate='<?xml version="1.0" encoding="utf-8"?>\n<s:Envelope s:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/" xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">\n	<s:Body>\n		<u:{ACTION_NAME} xmlns:u="{ACTION_TYPE}">\n{ACTION_VARS}		</u:{ACTION_NAME}>\n	</s:Body>\n</s:Envelope>\n',i.prototype.types={i1:function(a,b){var c=new Int8Array(1);return c[0]=a,i.prototype.checkAllowedValues(c[0],b)},i2:function(a,b){var c=new Int16Array(1);return c[0]=a,i.prototype.checkAllowedValues(c[0],b)},i4:function(a,b){var c=new Int32Array(1);return c[0]=a,i.prototype.checkAllowedValues(c[0],b)},ui1:function(a,b){var c=new Uint8Array(1);return c[0]=a,i.prototype.checkAllowedValues(c[0],b)},ui2:function(a,b){var c=new Uint16Array(1);return c[0]=a,i.prototype.checkAllowedValues(c[0],b)},ui4:function(a,b){var c=new Uint32Array(1);return c[0]=a,i.prototype.checkAllowedValues(c[0],b)},"int":function(a,c,d){return a===b||null===a||isNaN(a)?a=0:"number"!=typeof a&&(a=a===!0?1:parseInt(a+"",10)),d||(a=h(a+"")),isNaN(a)&&(a=0),i.prototype.checkAllowedValues(a,c)},r4:function(a,b,c){var d=new Float32Array(1);return d[0]=a,c?i.prototype.checkAllowedValues(d[0],b):d[0]?h(d[0]+""):"0"},r8:function(a,b,c){var d=new Float64Array(1);return d[0]=a,c?i.prototype.checkAllowedValues(d[0],b):d[0]?h(d[0]+""):"0"},number:function(a,b,c){return i.prototype.types.r8(a,b,c)},fixed_14_4:function(a,b,c){return i.prototype.types["float"](a,b,c)},"float":function(a,b,c){var d=parseFloat(a);return c?i.prototype.checkAllowedValues(d,b):d?h(d+""):"0"},"char":function(a,c){return a=a===b||null===a||""===a||a+""=="NaN"||a instanceof RegExp?"":a===!1||a===!0||"true"==a||"yes"==a||"false"==a||"no"==a?a===!0||"true"==a||"yes"==a?"1":"0":a.toString(),a.length>0?(a=i.prototype.checkAllowedValues(a,c),a.charAt(0)):a},string:function(a,c){return(a===b||null===a||""===a||a+""=="NaN"||a instanceof RegExp)&&(a=""),a+="",a=i.prototype.checkAllowedValues(a,c)},date:function(a,b,c){return i.prototype.types.dateTime(a,b,c)},dateTime:function(a,b,c){return c?"[object String]"==Object.prototype.toString.call(a)?(a=new Date(x(a)),isNaN(a)&&(a="")):"[object Date]"==Object.prototype.toString.call(a)&&(a=a):"[object String]"==Object.prototype.toString.call(a)?a+="":"[object Date]"==Object.prototype.toString.call(a)&&(a="Invalid Date"==a.toString()?"":a.toISOString()),a=i.prototype.checkAllowedValues(a,b)},dateTime_tz:function(a,b,c){return i.prototype.types.dateTime(a,b,c)},time:function(a,b,c){return i.prototype.types.dateTime(a,b,c)},time_tz:function(a,b,c){return i.prototype.types.dateTime(a,b,c)},"boolean":function(a,b,c){return a="false"==a||"f"==a||"no"==a||"n"==a||a instanceof RegExp||0>=a||!a?c?!1:"0":c?!0:"1"},bin_base64:function(a,c,d){return(a===b||null===a||""===a||a+""=="NaN"||a instanceof RegExp)&&(a=""),(a===!0||a===!1)&&(a=a===!0?"1":"0"),a=d?r(a+""):q(a+""),i.prototype.checkAllowedValues(a,c)},bin_hex:function(a,c,d){return(a===b||null===a||""===a||a+""=="NaN"||a instanceof RegExp)&&(a=""),(a===!0||a===!1)&&(a=a===!0?"1":"0"),a=d?f(a+""):g(a+""),i.prototype.checkAllowedValues(a,c)},uri:function(a,b,c){return c&&(a=decodeURI(a+"")),i.prototype.types.string(a,b)},uuid:function(a,b){return i.prototype.types.string(a,b)}};for(var j in i.prototype.types)i.prototype.types[j]._name=j,i.prototype.types[j].toString=function(){return this._name};i.prototype.createRequest=function(a,c,d){d=this.formatParameters(d),this.debugLog("Creating UPnP XML Control Message for ["+c+"] with parameters:"),this.debugLog(JSON?JSON.stringify(d):null);var e=this.requestTemplate.replace(/\{ACTION_TYPE\}/g,v(u(a)));e=e.replace(/\{ACTION_NAME\}/g,v(u(c)));var f=d.request,g="";if(f)for(var h in f){if(f[h].type!==b&&null!==f[h].type){var i=this.types[f[h].type];i&&(f[h].value=i(f[h].value,f[h].allowedValueList,!1))}(null===f[h].value||f[h].value===b)&&(f[h].value=""),g+="			<"+h+">"+v(u(f[h].value+""))+"</"+h+">\n"}return e=e.replace(/\{ACTION_VARS\}/g,g),this.debugLog("[REQUEST] (SOAPAction: "+a+"#"+c+") "+e),e},i.prototype.sendRequest=function(a,c,d,e,f){try{var g=k.get();g.open("POST",d),g.setRequestHeader("SOAPAction",'"'+a.replace(/[\"\#]/g,"")+"#"+c.replace(/[\"\#]/g,"")+'"'),g.setRequestHeader("Content-Type",'text/xml; charset="utf-8";'),g.onabort=g.onerror=function(){f.apply(b,[new l("XmlHttpRequest failed"),null]),k.release(g)};var h=this;g.onreadystatechange=function(){if(!(this.readyState<4)){if(200!==this.status)return f.apply(b,[new l("XmlHttpRequest expected 200 OK. Received "+this.status+" response."),null]),h.debugLog("[ERROR-RESPONSE] "+this.responseText),void k.release(g);h.debugLog("[SUCCESS-RESPONSE] "+this.responseText),f.apply(this,[null,this]),k.release(g)}},g.send(e)}catch(i){f.apply(b,[new l(i),null])}return this},i.prototype.handleResponse=function(a,c,d,e){d=this.formatParameters(d);var f=d.response,g={},h=c.getElementsByTagName?c.getElementsByTagName(a+"Response"):null;if((null===h||h.length<=0)&&(h=c.getElementsByTagName?c.getElementsByTagName("u:"+a+"Response"):null),null!==h&&h.length>0){var i=h[0].childNodes;if(i&&i.length>0)for(var j=0,k=i.length;k>j;j++){var l=i[j].nodeName,m=i[j].firstChild?u(w(i[j].firstChild.nodeValue+"")):null;if(f[l]&&f[l].type!==b&&null!==f[l].type){var n=this.types[f[l].type];n&&(m=n(m,f[l].allowedValueList||null,!0))}g[l]=m!==b&&null!==m?m:""}}return e.apply(b,[null,{data:g}]),this},i.prototype.formatParameter=function(a){var c={};return a.type!==b||a.value!==b||a.allowedValueList!==b?(c=a,a.allowedValueList!==b&&"array"!=typeof a.allowedValueList&&(a.allowedValueList=[])):c={value:a},c.type!==b&&null!==c.type&&(this.types[c.type+""]||delete c.type),c},i.prototype.formatParameters=function(a){(a===b||null===a)&&(a={}),a.request||(a.request={}),a.response||(a.response={});for(var c in a)if("request"===c||"response"===c)for(var d in a[c])a[c][d]=this.formatParameter(a[c][d]);else a.request[c]=this.formatParameter(a[c]),delete a[c];return a},i.prototype.checkAllowedValues=function(a,b){if(a&&b&&"[object Array]"==Object.prototype.toString.call(b)){for(var c=!1,d=0,e=b.length;e>d;d++)if(a==b[d]){c=!0;break}if(!c)return""}return a},i.prototype.debugLog=function(a,b){this.options&&this.options.debug&&console[b||"log"]("Plug.UPnP: "+a)};var k=function(){var a=[];return{get:function(){return a.pop()||new XMLHttpRequest},release:function(b){b.onreadystatechange=function(){},a.push(b)}}}(),l=function(a){return{description:a}},m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=function(a){for(var b={},c=0,d=a.length;d>c;c++)b[a.charAt(c)]=c;return b}(m),o=function(a){var b=[0,2,1][a.length%3],c=a.charCodeAt(0)<<16|(a.length>1?a.charCodeAt(1):0)<<8|(a.length>2?a.charCodeAt(2):0),d=[m.charAt(c>>>18),m.charAt(c>>>12&63),b>=2?"=":m.charAt(c>>>6&63),b>=1?"=":m.charAt(63&c)];return d.join("")},p=function(a){var b=a.length,c=b%4,d=(b>0?n[a.charAt(0)]<<18:0)|(b>1?n[a.charAt(1)]<<12:0)|(b>2?n[a.charAt(2)]<<6:0)|(b>3?n[a.charAt(3)]:0),e=[String.fromCharCode(d>>>16),String.fromCharCode(d>>>8&255),String.fromCharCode(255&d)];return e.length-=[0,0,2,1][c],e.join("")},q=a.btoa||function(a){return a.replace(/[\s\S]{1,3}/g,o)},r=a.atob||function(a){return a.replace(/[\s\S]{1,4}/g,p)},s="0123456789abcdef",t=function(a){for(var b={},c=0,d=a.length;d>c;c++)b[c]=a.charAt(c);return b}(s),u=function(a){return String.prototype.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},v=function(a){return a.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")},w=function(a){return a.replace(/\&quot;/g,'"').replace(/\&\#39;/g,"'").replace(/\&gt;/g,">").replace(/\&lt;/g,"<").replace(/\&amp;/g,"&")},x=function(a){var c,d,e=0,f=[1,4,5,6,7,10,11];if("string"!=typeof a&&(a+=""),d=/^((\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:[T\s]?(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{4}))?)?$/.exec(a)){d=d.slice(1,d.length);for(var g,h=0;g=f[h];++h)d[g]=+d[g]||0;d[2]=(+d[2]||1)-1,d[3]=+d[3]||1,"Z"!==d[8]&&d[9]!==b&&(e=60*(d[10]/100-d[10]/100%1)+d[10]%100,"+"===d[9]&&(e=0-e)),c=Date.UTC(d[1],d[2],d[3],d[4],d[5]+e,d[6],d[7])}else c=Date.parse?Date.parse(a):0/0;return c};a.Plug||(a.Plug={}),a.Plug.UPnP||(a.Plug.UPnP=i)}(this);